# Система мониторинга веб-страниц

Система позволяет отслеживать действия пользователей на веб-страницах в реальном времени с использованием WebSocket соединения. Администраторы могут отправлять сообщения пользователям и управлять настройками мониторинга через удобную панель управления.

## Особенности проекта

- Мониторинг активности пользователей в реальном времени
- Система уникальных кодов доступа
- Административная панель управления
- Управление пользователями с разными уровнями доступа
- Система сообщений для пользователей
- **Сохранение данных в GitHub в качестве базы данных**

## Новая функция: GitHub в качестве базы данных

В систему была добавлена возможность использовать GitHub репозиторий для хранения данных, что позволяет сохранять всю информацию между перезапусками сервера. Данные хранятся в структурированном виде в формате JSON в репозитории GitHub.

### Как это работает

1. Данные хранятся в отдельных файлах в формате `/data/<collection>-<id>.json`
2. При запуске сервера данные автоматически загружаются из GitHub репозитория
3. При изменении данных они автоматически сохраняются в репозиторий
4. Все операции выполняются асинхронно с использованием Octokit API

### Настройка GitHub базы данных

1. **Создайте GitHub репозиторий** для хранения данных
2. **Создайте GitHub Personal Access Token** с доступом к репозиторию:
   - Перейдите в настройки GitHub: Settings > Developer settings > Personal access tokens > Tokens (classic)
   - Создайте новый токен с правами `repo`
3. **Создайте файл `.env`** в корне проекта со следующими параметрами:
   ```
   # GitHub Personal Access Token с правами repo
   GITHUB_TOKEN=your_github_token_here
   
   # Владелец репозитория (имя пользователя или организации)
   GITHUB_OWNER=your_github_username_or_org
   
   # Название репозитория
   GITHUB_REPO=your_repo_name
   
   # Ветка для сохранения данных (опционально, по умолчанию 'main')
   GITHUB_BRANCH=main
   
   # Папка для хранения данных (опционально, по умолчанию 'data')
   GITHUB_DATA_FOLDER=data
   
   # Интервал автосохранения в миллисекундах (опционально, по умолчанию 1000)
   GITHUB_SAVE_DEBOUNCE=1000
   
   # Включить автоматическое сохранение (опционально, по умолчанию true)
   GITHUB_AUTO_SAVE=true
   
   # Настройки сервера
   PORT=3000
   ```

### Поддерживаемые коллекции данных

- `users` - учетные записи пользователей
- `accessCodes` - коды доступа для клиентов
- `activeSessions` - активные сессии пользователей
- `clientsMessageHistory` - история сообщений для клиентов

### Автоматическое сохранение

Данные автоматически сохраняются в GitHub:
- При создании, изменении или удалении данных
- Через регулярные интервалы времени (по умолчанию каждую минуту)
- При остановке сервера (обработчик завершения работы)

## Установка и запуск

1. Клонировать репозиторий:
   ```
   git clone <repository-url>
   cd <repository-directory>
   ```

2. Установить зависимости:
   ```
   npm install
   ```

3. Создать и настроить файл `.env` (см. выше)

4. Запустить сервер:
   ```
   npm start
   ```
   
   Для разработки:
   ```
   npm run dev
   ```

5. Открыть в браузере:
   ```
   http://localhost:3000
   ```

## Режим без GitHub

Если параметры GitHub не настроены, система будет работать с хранением данных в памяти. В этом случае данные будут теряться при перезапуске сервера.

## Экспорт и импорт данных

Для сохранения данных без GitHub используйте функции экспорта и импорта:

1. **Экспорт данных**: Перейдите в раздел "Экспорт/Импорт" в админ-панели и нажмите кнопку "Экспортировать данные". Данные будут скачаны в виде JSON-файла.

2. **Импорт данных**: Перейдите в раздел "Экспорт/Импорт" в админ-панели, выберите файл для импорта и нажмите кнопку "Импортировать данные".

## Технологии

- Node.js
- Express
- WebSocket (ws)
- GitHub API (Octokit)
- JavaScript 